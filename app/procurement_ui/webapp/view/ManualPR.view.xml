<mvc:View
    controllerName="com.procurement.ui.controller.ManualPR"
    xmlns:mvc="sap.ui.core.mvc"
    xmlns="sap.m"
    xmlns:l="sap.ui.layout"
    xmlns:f="sap.ui.layout.form"
    xmlns:core="sap.ui.core"
    displayBlock="true">
    <Page title="New Purchase Request" showNavButton="true" navButtonPress=".onNavBack">
        <content>
            <!-- 1. MODE SELECTION -->
            <Panel width="auto" class="sapUiResponsiveMargin" accessibleRole="Region">
                <headerToolbar>
                    <Toolbar height="3rem">
                        <Title text="Request Details" />
                        <ToolbarSpacer />
                        <!-- The Toggle Switch -->
                        <SegmentedButton selectedKey="{view>/procurementMode}" selectionChange=".onModeChange">
                            <items>
                                <SegmentedButtonItem key="catalog" icon="sap-icon://cart" text="Catalog Item" />
                                <SegmentedButtonItem key="manual" icon="sap-icon://edit" text="Free Text (Manual)" />
                            </items>
                        </SegmentedButton>
                    </Toolbar>
                </headerToolbar>

                <content>
                    <!-- 2. PROFESSIONAL FORM LAYOUT -->
                    <f:SimpleForm 
                        editable="true"
                        layout="ResponsiveGridLayout"
                        labelSpanXL="4" labelSpanL="4" labelSpanM="4" labelSpanS="12"
                        adjustLabelSpan="false"
                        emptySpanXL="0" emptySpanL="0" emptySpanM="0" emptySpanS="0"
                        columnsXL="2" columnsL="2" columnsM="1"
                        singleContainerFullSize="false">
                        
                        <f:content>
                            
                            <!-- MATERIAL SELECTION -->
                            <Label text="Material" required="true" />
                            
                            <!-- A. Catalog Dropdown (Visible if Mode = catalog) -->
                            <ComboBox 
                                id="materialCombo"
                                visible="{= ${view>/procurementMode} === 'catalog' }"
                                items="{
                                    path: '/Materials',
                                    sorter: { path: 'description' }
                                }"
                                selectionChange=".onMaterialSelect"
                                placeholder="Select from Catalog...">
                                <core:Item key="{ID}" text="{description} ({ID})" />
                            </ComboBox>

                            <!-- B. Manual Input (Visible if Mode = manual) -->
                            <Input 
                                id="manualInput"
                                visible="{= ${view>/procurementMode} === 'manual' }"
                                value="{view>/manualDescription}"
                                placeholder="Describe the item (e.g. Birthday Cake)" />

                            <!-- QUANTITY -->
                            <Label text="Quantity" required="true" />
                            <StepInput 
                                value="{view>/quantity}" 
                                min="1" 
                                max="1000"
                                width="50%" />

                            <!-- PRICE -->
                            <Label text="Estimated Price" />
                            <Input 
                                id="priceInput"
                                value="{view>/price}" 
                                description="{view>/currency}"
                                editable="{= ${view>/procurementMode} === 'manual' }" 
                                type="Number"
                                placeholder="0.00" />

                            <!-- VENDOR -->
                            <Label text="Preferred Vendor" />
                            <ComboBox 
                                id="vendorCombo"
                                selectedKey="{view>/selectedVendorID}"
                                items="{
                                    path: '/Suppliers',
                                    sorter: { path: 'name' }
                                }"
                                placeholder="Select Supplier...">
                                <core:Item key="{ID}" text="{name} - {city}" />
                            </ComboBox>

                            <!-- COST CENTER (Required for Manual) -->
                            <Label text="Cost Center" required="{= ${view>/procurementMode} === 'manual' }" />
                            <ComboBox 
                                items="{/CostCenters}"
                                visible="{= ${view>/procurementMode} === 'manual' }"
                                placeholder="Select Cost Center">
                                <core:Item key="{ID}" text="{description}" />
                            </ComboBox>

                        </f:content>
                    </f:SimpleForm>
                </content>
            </Panel>
        </content>

        <!-- 3. PROFESSIONAL FOOTER -->
        <footer>
            <OverflowToolbar>
                <ToolbarSpacer />
                <Button type="Reject" text="Cancel" press=".onNavBack" />
                <Button type="Accept" text="Add to Request" press=".onAddToRequest" />
                <Button type="Emphasized" text="Review &amp; Submit ({= ${cart>/items}.length })" press=".onGoToCart" />
            </OverflowToolbar>
        </footer>
    </Page>
</mvc:View>
